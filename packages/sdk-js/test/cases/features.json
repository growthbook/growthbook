[
  [
    "unknown feature key",
    {},
    "my-feature",
    {
      "value": null,
      "on": false,
      "off": true,
      "source": "unknownFeature"
    }
  ],
  [
    "defaults when empty",
    { "features": { "feature": {} } },
    "feature",
    {
      "value": null,
      "on": false,
      "off": true,
      "source": "defaultValue"
    }
  ],
  [
    "uses defaultValue - number",
    { "features": { "feature": { "defaultValue": 1 } } },
    "feature",
    {
      "value": 1,
      "on": true,
      "off": false,
      "source": "defaultValue"
    }
  ],
  [
    "uses custom values - string",
    { "features": { "feature": { "defaultValue": "yes" } } },
    "feature",
    {
      "value": "yes",
      "on": true,
      "off": false,
      "source": "defaultValue"
    }
  ],
  [
    "force rules",
    {
      "features": {
        "feature": {
          "defaultValue": 2,
          "rules": [
            {
              "force": 1
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 1,
      "on": true,
      "off": false,
      "source": "force"
    }
  ],
  [
    "force rules - coverage included",
    {
      "attributes": {
        "id": "3"
      },
      "features": {
        "feature": {
          "defaultValue": 2,
          "rules": [
            {
              "force": 1,
              "coverage": 0.5
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 1,
      "on": true,
      "off": false,
      "source": "force"
    }
  ],
  [
    "force rules - coverage excluded",
    {
      "attributes": {
        "id": "1"
      },
      "features": {
        "feature": {
          "defaultValue": 2,
          "rules": [
            {
              "force": 1,
              "coverage": 0.5
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 2,
      "on": true,
      "off": false,
      "source": "defaultValue"
    }
  ],
  [
    "force rules - coverage missing hashAttribute",
    {
      "attributes": {},
      "features": {
        "feature": {
          "defaultValue": 2,
          "rules": [
            {
              "force": 1,
              "coverage": 0.5
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 2,
      "on": true,
      "off": false,
      "source": "defaultValue"
    }
  ],
  [
    "force rules - condition pass",
    {
      "attributes": {
        "country": "US",
        "browser": "firefox"
      },
      "features": {
        "feature": {
          "defaultValue": 2,
          "rules": [
            {
              "force": 1,
              "condition": {
                "country": { "$in": ["US", "CA"] },
                "browser": "firefox"
              }
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 1,
      "on": true,
      "off": false,
      "source": "force"
    }
  ],
  [
    "force rules - condition fail",
    {
      "attributes": {
        "country": "US",
        "browser": "chrome"
      },
      "features": {
        "feature": {
          "defaultValue": 2,
          "rules": [
            {
              "force": 1,
              "condition": {
                "country": { "$in": ["US", "CA"] },
                "browser": "firefox"
              }
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 2,
      "on": true,
      "off": false,
      "source": "defaultValue"
    }
  ],
  [
    "ignores empty rules",
    {
      "features": {
        "feature": {
          "rules": [{}]
        }
      }
    },
    "feature",
    {
      "value": null,
      "on": false,
      "off": true,
      "source": "defaultValue"
    }
  ],
  [
    "empty experiment rule - c",
    {
      "attributes": {
        "id": "123"
      },
      "features": {
        "feature": {
          "rules": [
            {
              "variations": ["a", "b", "c"]
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": "c",
      "on": true,
      "off": false,
      "experiment": {
        "key": "feature",
        "variations": ["a", "b", "c"]
      },
      "source": "experiment"
    }
  ],
  [
    "empty experiment rule - a",
    {
      "attributes": {
        "id": "456"
      },
      "features": {
        "feature": {
          "rules": [
            {
              "variations": ["a", "b", "c"]
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": "a",
      "on": true,
      "off": false,
      "experiment": {
        "key": "feature",
        "variations": ["a", "b", "c"]
      },
      "source": "experiment"
    }
  ],
  [
    "empty experiment rule - b",
    {
      "attributes": {
        "id": "fds"
      },
      "features": {
        "feature": {
          "rules": [
            {
              "variations": ["a", "b", "c"]
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": "b",
      "on": true,
      "off": false,
      "experiment": {
        "key": "feature",
        "variations": ["a", "b", "c"]
      },
      "source": "experiment"
    }
  ],
  [
    "creates experiments properly",
    {
      "attributes": {
        "anonId": "123",
        "premium": true
      },
      "features": {
        "feature": {
          "rules": [
            {
              "coverage": 0.99,
              "hashAttribute": "anonId",
              "namespace": ["pricing", 0, 1],
              "key": "hello",
              "variations": [true, false],
              "weights": [0.1, 0.9],
              "condition": { "premium": true }
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": false,
      "on": false,
      "off": true,
      "source": "experiment",
      "experiment": {
        "coverage": 0.99,
        "hashAttribute": "anonId",
        "namespace": ["pricing", 0, 1],
        "key": "hello",
        "variations": [true, false],
        "weights": [0.1, 0.9]
      }
    }
  ],
  [
    "rule orders - skip 1",
    {
      "attributes": {
        "browser": "firefox"
      },
      "features": {
        "feature": {
          "defaultValue": 0,
          "rules": [
            {
              "force": 1,
              "condition": { "browser": "chrome" }
            },
            {
              "force": 2,
              "condition": { "browser": "firefox" }
            },
            {
              "force": 3,
              "condition": { "browser": "safari" }
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 2,
      "on": true,
      "off": false,
      "source": "force"
    }
  ],
  [
    "rule orders - skip 1,2",
    {
      "attributes": {
        "browser": "safari"
      },
      "features": {
        "feature": {
          "defaultValue": 0,
          "rules": [
            {
              "force": 1,
              "condition": { "browser": "chrome" }
            },
            {
              "force": 2,
              "condition": { "browser": "firefox" }
            },
            {
              "force": 3,
              "condition": { "browser": "safari" }
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 3,
      "on": true,
      "off": false,
      "source": "force"
    }
  ],
  [
    "rule orders - skip all",
    {
      "attributes": {
        "browser": "ie"
      },
      "features": {
        "feature": {
          "defaultValue": 0,
          "rules": [
            {
              "force": 1,
              "condition": { "browser": "chrome" }
            },
            {
              "force": 2,
              "condition": { "browser": "firefox" }
            },
            {
              "force": 3,
              "condition": { "browser": "safari" }
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 0,
      "on": false,
      "off": true,
      "source": "defaultValue"
    }
  ],
  [
    "skips experiment on coverage",
    {
      "attributes": { "id": "123" },
      "features": {
        "feature": {
          "defaultValue": 0,
          "rules": [
            {
              "variations": [0, 1, 2, 3],
              "coverage": 0.01
            },
            {
              "force": 3
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 3,
      "on": true,
      "off": false,
      "source": "force"
    }
  ],
  [
    "skips experiment on namespace",
    {
      "attributes": { "id": "123" },
      "features": {
        "feature": {
          "defaultValue": 0,
          "rules": [
            {
              "variations": [0, 1, 2, 3],
              "namespace": ["pricing", 0, 0.01]
            },
            {
              "force": 3
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 3,
      "on": true,
      "off": false,
      "source": "force"
    }
  ],
  [
    "skip experiment on missing hashAttribute",
    {
      "attributes": { "id": "123" },
      "features": {
        "feature": {
          "defaultValue": 0,
          "rules": [
            {
              "variations": [0, 1, 2, 3],
              "hashAttribute": "company"
            },
            {
              "force": 3
            }
          ]
        }
      }
    },
    "feature",
    {
      "value": 3,
      "on": true,
      "off": false,
      "source": "force"
    }
  ]
]
