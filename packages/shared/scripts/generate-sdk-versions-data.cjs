#!/usr/bin/env node
/**
 * Generates sdk-versions-data.ts from JSON files.
 * Run before build/dev - output is bundled-friendly (no node:module).
 */
const fs = require("fs");
const path = require("path");

const VERSIONS_DIR = path.join(__dirname, "../src/sdk-versioning/sdk-versions");
const OUTPUT_FILE = path.join(__dirname, "../src/sdk-versioning/sdk-versions-data.generated.ts");

const jsonFiles = fs.readdirSync(VERSIONS_DIR).filter((f) => f.endsWith(".json"));

const lines = [
  "// AUTO-GENERATED by scripts/generate-sdk-versions-data.cjs - do not edit",
  "",
];

for (const file of jsonFiles.sort()) {
  const name = path.basename(file, ".json");
  const varName = name.replace(/-/g, "_") + "_json";
  const content = fs.readFileSync(path.join(VERSIONS_DIR, file), "utf-8");
  const parsed = JSON.parse(content);
  lines.push(`export const ${varName} = ${JSON.stringify(parsed)} as const;`);
  lines.push("");
}

fs.writeFileSync(OUTPUT_FILE, lines.join("\n"), "utf-8");
console.log(`Generated ${OUTPUT_FILE} with ${jsonFiles.length} SDK version files`);
