type: object
required:
  - datasourceId
  - name
  - type
properties:
  datasourceId:
    type: string
    description: ID for the [DataSource](#tag/DataSource_model)
  name:
    type: string
    description: Name of the metric
  description:
    type: string
    description: Description of the metric
  owner:
    type: string
    description: Name of the person who owns this metric
  type:
    type: string
    description: Type of metric. See [Metrics documentation](/app/metrics)
    enum:
      - binomial
      - count
      - duration
      - revenue
  tags:
    type: array
    description: List of tags
    items:
      type: string
  projects:
    type: array
    description: List of project IDs for projects that can access this metric
    items:
      type: string
  behavior:
    type: object
    required:
      - goal
      - cap
      - conversionWindowStart
      - conversionWindowEnd
      - riskThresholdSuccess
      - riskThresholdDanger
      - minPercentChange
      - maxPercentChange
      - minSampleSize
    properties:
      goal:
        type: string
        enum:
          - increase
          - decrease
      cap:
        type: number
        description: This should be non-negative
      conversionWindowStart:
        type: number
        description: The [Conversion Delay](/app/metrics#conversion-delay) in hours
      conversionWindowEnd:
        type: number
        description: The [Conversion Window](/app/metrics#conversion-window), in hours
      riskThresholdSuccess:
        type: number
      riskThresholdDanger:
        type: number
      minPercentChange:
        type: number
        description: Minimum percent change to consider uplift significant, as a proportion (e.g. put 0.5 for 50%)
      maxPercentChange:
        type: number
        description: Maximum percent change to consider uplift significant, as a proportion (e.g. put 0.5 for 50%)
      minSampleSize:
        type: number
  sql:
    type: object
    required:
      - identifierTypes
      - conversionSQL
    properties:
      identifierTypes:
        type: array
        description: The [Identifier Types](/app/datasources#identifier-types) in your Data Source that are available for this metric
        items:
          type: string
      conversionSQL:
        type: string
        description: The main SQL to retrieve your metric
      userAggregationSQL:
        type: string
        description: "Custom user level aggregation for your metric (default: SUM(value))"
      denominatorMetricId:
        type: string
        description: "The metric ID for a [denominator metric for funnel and ratio metrics](/app/metrics#denominator-ratio--funnel-metrics)"
      builder:
        type: object
        description: "An alternative way to specify your metric to a full query. Using the top-level `sql.conversionSql` and `sql.identifierTypes` is preferred."
        required:
          - identifierTypeColumns
          - tableName
          - timestampColumnName
        properties:
          identifierTypeColumns:
            type: array
            items:
              type: object
              required:
                - identifierType
                - columnName
              properties:
                identifierType:
                  type: string
                columnName:
                  type: string
          tableName:
            type: string
          valueColumnName:
            type: string
          timestampColumnName:
            type: string
          conditions:
            type: array
            items:
              type: object
              required:
                - column
                - operator
                - value
              properties:
                column:
                  type: string
                operator:
                  type: string
                value:
                  type: string
  mixpanel:
    type: object
    description: Only use for MixPanel (non-SQL) Data Sources. If providing this field, omit `sql`.
    required:
      - eventName
      - eventValue
      - userAggregation
      - conditions
    properties:
      eventName:
        type: string
      eventValue:
        type: string
      userAggregation:
        type: string
      conditions:
        type: array
        items:
          type: object
          required:
            - property
            - operator
            - value
          properties:
            property:
              type: string
            operator:
              type: string
            value:
              type: string